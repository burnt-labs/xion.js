# Xion.js Demo App

This is a Next.js demo application showcasing the Abstraxion wallet integration and Xion blockchain interactions.

## Getting Started

### Prerequisites

- Node.js 18+ and pnpm
- Cloudflare account (for deployment)
- Wrangler CLI (installed as a dev dependency)

### Development

First, install dependencies from the monorepo root:

```bash
pnpm install
```

Then run the development server:

```bash
pnpm dev
```

Open [http://localhost:3001](http://localhost:3001) with your browser to see the result.

You can start editing the page by modifying `src/app/page.tsx`. The page auto-updates as you edit the file.

## Deployment to Cloudflare Workers

This app is configured to deploy to Cloudflare Workers using OpenNext.js.

### Setup R2 Bucket (First Time Only)

1. Log in to your Cloudflare dashboard
2. Navigate to R2 Storage
3. Create a new bucket named `xion-demo-app-cache`
4. Note: The bucket name must match the one in `wrangler.jsonc`

### Environment Variables

Next.js and Cloudflare Workers handle environment variables differently:

#### Build-time Environment Variables (Next.js)

For variables needed during the build process (e.g., `NEXT_PUBLIC_*` variables):
- Create a `.env.local` file in the app root
- These variables are embedded into the build at compile time
- Public variables must be prefixed with `NEXT_PUBLIC_`

```env
# .env.local
NEXT_PUBLIC_API_URL=https://api.example.com
NEXT_PUBLIC_APP_NAME=Xion Demo
```

#### Runtime Environment Variables (Cloudflare Workers)

For variables accessed at runtime in your worker:

**Local Development** - Create a `.dev.vars` file (this file is gitignored):
```env
# .dev.vars
DATABASE_URL=your-database-url
API_KEY=your-secret-key
```

**Important Notes:**
- Build-time vars (`NEXT_PUBLIC_*`) are baked into the client bundle
- Runtime vars in `.dev.vars` are only available server-side
- Never expose secrets in `NEXT_PUBLIC_*` variables
- The `worker-configuration.d.ts` file is auto-generated by Wrangler and provides TypeScript types
- After adding new runtime env vars, run `pnpm cf-typegen` to update TypeScript types

### Available Scripts

```bash
# Preview the worker locally (builds and runs on local Cloudflare runtime)
pnpm preview

# Deploy to Cloudflare Workers
pnpm deploy

# Build and upload without publishing (useful for CI/CD)
pnpm upload

# Generate TypeScript types for Cloudflare environment
pnpm cf-typegen
```

### Deployment Process

1. **Preview locally** (recommended before deploying):
   ```bash
   pnpm preview
   ```
   This builds the app and runs it using Wrangler's local runtime.

2. **Deploy to production**:
   ```bash
   pnpm deploy
   ```
   This builds and deploys your app to Cloudflare Workers.

### Configuration Files

- `wrangler.jsonc` - Cloudflare Workers configuration
- `open-next.config.ts` - OpenNext.js configuration for Cloudflare
- `worker-configuration.d.ts` - Auto-generated TypeScript types for Worker environment (run `pnpm cf-typegen` to regenerate)

## API Routes

To create [API routes](https://nextjs.org/docs/app/building-your-application/routing/router-handlers) add an `api/` directory to the `app/` directory with a `route.ts` file. For individual endpoints, create a subfolder in the `api` directory, like `api/hello/route.ts` would map to [http://localhost:3001/api/hello](http://localhost:3001/api/hello).

## Learn More

- [Abstraxion Documentation](https://docs.burnt.com/abstraxion) - Learn about wallet abstraction
- [Xion Documentation](https://docs.burnt.com) - Learn about the Xion blockchain
- [Next.js Documentation](https://nextjs.org/docs) - Learn about Next.js features and API
- [Cloudflare Workers](https://developers.cloudflare.com/workers/) - Learn about Cloudflare Workers
- [OpenNext.js](https://opennext.js.org/) - Learn about deploying Next.js to edge runtimes
